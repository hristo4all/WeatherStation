<!DOCTYPE HTML>
<html>

<head>
    <title>Weather Station</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="../static/weather-icons-master/css/weather-icons.css">
    <link rel="stylesheet" href="../static/weather-icons-master/css/weather-icons.min.css">
        <link rel="stylesheet" href="../static/main.css">
    <script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>

    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

    <script type="text/javascript" charset="utf-8">
        $(document).ready(function() {
            // Use weather namespace.
            namespace = '/Weather';

            var tempData = [];
            var currTemp = null;
            var time = null;
            // Connect to the Socket.IO server.
            var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

            // Event handler for new connections.
            socket.on('connect', function() {
                socket.emit('my_event', {
                    data: 'I\'m connected!'
                });
            });

            // Event handler for server sent data.
            socket.on('my_response', function(msg) {
                $('#Temperature').text(msg.T +'C');
                $('#Pressure').text(msg.P +'hPa');
                $('#Humidity').text(msg.H);
                $('#Time').text(msg.S);
                

                
                const today = new Date(msg.S);
                let hour = today.getHours();
                let minutes = today.getMinutes();
                //const d = new Date();
                //et hour = d.getHours();
                //console.log(hour);


                var a = `${hour}.${minutes}`;

                var parsed = parseFloat(a);

                console.log(parsed);


                if(isNaN(msg.S) && msg.T != "Reading..."){
                    
                    currTemp = parseFloat(msg.T);
                    $('#Test').text(currTemp);
                    tempData.push({
                        x:parsed,
                        y:currTemp
                    })

                }
                //onsole.log(msg.T);
                //console.log(msg.P);
                //console.log(msg.H);
                //console.log(msg.S);
                //console.log(tempData);
                //currTemp= msg.T;
                
                //tempData.push(currTemp);
                //console.log(tempData);
            });

            var xVal = 0;
            var yVal = 100; 
            var updateInterval = 2000;
            var dataLength = 5; // number of dataPoints visible at any point
            //var dps = [];
            //console.log(dps)

            var chart = new CanvasJS.Chart("chartContainer", {
                title :{
                    text: "Temperature"
                },
                data: [{
                    type: "line",
                    dataPoints: tempData
                }]
            });
 
            var updateChart = function (count) {
    
                count = count || 1;
    
                /*for (var j = 0; j < count; j++) {
                    yVal = yVal +  Math.round(5 + Math.random() *(-5-5));
                    dps.push({
                        x: xVal,
                        y: yVal
                    });
         
                    xVal++;
                    console.log(dps)
                }*/
            
                if (tempData.length > dataLength) {
                    tempData.shift();
                }
            
                chart.render();
                //chart2.render();
            };
            updateChart(dataLength);
            setInterval(function(){updateChart()}, updateInterval);
            
         

        });// end of function onload
    </script>
</head>

<body>
    <div class="header">Raspberry Pi Weather Station</div>
    </div>
    <div class="container">
    <!-------------------------------------------------------------------------------------------------->
        <div class="currentMeasurements">
            <h1 class="curHeader">Current Weather Conditions</h1> 
           
            <div class="card">  
                <i class=" wi wi-thermometer"></i>
                <div class="wrapper">
                    <p class="label">Temperature</p>
                    <p id="Temperature"></p>
                </div>
            </div>
            <div class="card">  
                <i class=" wi wi-barometer"></i>
                <div class="wrapper">
                    <p class="label">Pressure</p>
                    <p id="Pressure"></p>
                </div>
            </div>
            <div class="card">  
                <i class=" wi wi-humidity"></i>
                <div class="wrapper">
                    <p class="label">Humidity</p>
                    <p id="Humidity"></p>
                </div>
            </div>
              <div class="card">  
                <i class=" wi wi-time-5"></i>
                <div class="wrapper">
                    <p class="label">Time</p>
                    <p id="Time"></p>
                </div>
            </div>
            <div class="card">  
                <i class=" wi wi-time-5"></i>
                <div class="wrapper">
                    <p class="label">Test</p>
                    <p id="Test"></p>
                </div>
            </div>

            <div id="chartContainer" style="height: 300px; width:50%;"></div>
            <div id="chartContainer2" style="height: 300px; width:50%;"></div>
        </div>
    <!-------------------------end of currentMeasurements------------------------------------------------------------------------->
        <div class="info">
                
        </div>
        <!-------------------------end of info------------------------------------------------------------------------->
        <div class="historicMeasurements">

        </div>
        <!-------------------------historicMeasurements------------------------------------------------------------------------->
    </div>
    <!---end of container -->
 
</body>
</html>
